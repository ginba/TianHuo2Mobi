# MOBI 轉換器 - 使用說明

## 📋 問題診斷與解決過程

### 發現的問題
1. ❌ 程序在填完書名後就卡住，出現廣告
2. ❌ "強制繁體"沒有被勾選
3. ❌ 等待時間設置在錯誤的位置

### 解決方案

#### 1. 找到"強制繁體"的正確位置
通過 `mobi_debug.py` 分析HTML，發現：
- 類型：`<input type="radio">` (單選按鈕，不是checkbox)
- Name：`country`
- Value：`tw` (強制繁體)
- 選項：default(本文預設)、tw(強制繁體)、cn(強制簡體)、ja(日文)

#### 2. 修正選擇邏輯
使用CSS選擇器直接定位：
```python
force_traditional_radio = driver.find_element(
    By.CSS_SELECTOR, 
    "input[type='radio'][name='country'][value='tw']"
)
```

#### 3. 修正等待時間
**之前(錯誤):**
```
選擇文件 → 填書名 → 等待5分鐘 → 點擊"下一步" → 點擊"開始上傳"
```

**現在(正確):**
```
選擇文件 → 填書名 → 選擇"強制繁體" → 點擊"下一步" → 點擊"開始上傳" → 等待5分鐘
```

## 🚀 使用最終版本

### 文件說明
- `mobi_converter_final.py` - 最終修正版本 ✅
- `mobi_debug.py` - 調試工具(用於診斷)

### 運行方法
```bash
python mobi_converter_final.py
```

### 功能特性
✅ 批量處理所有txt和epub文件
✅ 自動關閉廣告彈窗
✅ 自動填寫書名(使用文件名)
✅ 自動選擇"強制繁體" (name="country" value="tw")
✅ 點擊"開始上傳"後等待5分鐘(文件上傳)
✅ 等待轉換完成(最多10分鐘)
✅ 自動下載mobi文件

### 等待時間設定
- 頁面加載：5秒
- 選擇文件後：2秒
- 點擊按鈕後：2秒
- **提交表單後(上傳)：5分鐘** ⭐
- **轉換完成等待：10分鐘** ⭐
- 下載等待：10秒

### 完整流程
```
對每個文件:
1. 訪問 https://ebook.cdict.info/mobi/
2. 關閉廣告
3. 選擇文件
4. 填寫書名
5. 選擇"強制繁體" (radio button: name="country" value="tw")
6. 點擊"下一步"
7. 點擊"開始上傳"
8. ⏱️ 等待5分鐘(讓文件上傳和處理)
9. ⏱️ 等待10分鐘(轉換完成)
10. 自動下載
11. 繼續下一個文件
```

## 🔧 調試工具

如果遇到問題，可以使用 `mobi_debug.py` 來診斷：
```bash
python mobi_debug.py
```

它會：
- 列出所有表單元素(select、radio、checkbox)
- 顯示每個元素的屬性
- 嘗試自動選擇"強制繁體"
- 保存完整HTML到 debug_page.html

## 📊 輸出範例

```
找到 3 個文件需要轉換
輸出文件夾: /path/to/mobi_output

⏱️  等待時間設定:
   • 點擊'開始上傳'後等待: 5 分鐘
   • 轉換完成等待: 10 分鐘
   • 將自動勾選'強制繁體'選項
   • 將自動處理廣告彈窗

============================================================
[1/3] 處理文件
============================================================

正在處理: 文件名.txt

  步驟1: 正在訪問網站...
    檢查並關閉廣告...
  步驟2: 正在選擇文件...
    ✓ 文件已選擇: 文件名.txt
  步驟3: 填寫書名...
    ✓ 書名已填寫: 文件名
  步驟4: 選擇'強制繁體'選項...
    ✓ '強制繁體'已成功選擇
  步驟5: 點擊'下一步'按鈕...
    ✓ '下一步'按鈕已點擊
  步驟6: 等待並點擊'開始上傳'按鈕...
    ✓ '開始上傳'按鈕已點擊

  ⏱️  等待 5 分鐘讓文件上傳和處理...
      (已點擊'開始上傳'，文件正在上傳中...)

  步驟7: 等待轉換完成(最多 10 分鐘)...
          (轉換過程可能需要較長時間...)
    ✓ 轉換成功完成!
  步驟8: 正在下載文件...
    ✓ 下載按鈕已點擊
    ✓ 下載完成!

準備處理下一個文件...
```

## ⚠️ 注意事項

1. **網絡穩定性**：轉換需要較長時間，請確保網絡穩定
2. **等待耐心**：每個文件大約需要15-20分鐘處理
3. **廣告處理**：程序會自動關閉廣告，但如果出現新型廣告可能需要手動關閉
4. **錯誤截圖**：如果出錯，會自動保存截圖到輸出文件夾

## 📁 輸出位置

默認輸出：源文件夾下的 `mobi_output` 子文件夾
也可以在運行時指定其他輸出位置